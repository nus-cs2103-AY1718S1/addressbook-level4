= ModU - Developer Guide
:toc:
:toc-title:
:toc-placement: preamble
:sectnums:
:imagesDir: images
:stylesDir: stylesheets
ifdef::env-github[]
:tip-caption: :bulb:
:note-caption: :information_source:
endif::[]
ifdef::env-github,env-browser[:outfilesuffix: .adoc]
:repoURL: https://github.com/se-edu/addressbook-level4/tree/master

By: `CS2103AUG2017-W13-B4`      Since: `Jun 2016`      Licence: `MIT`

== Introduction
// tag::intro[]
ModU is a software design to help teachers and lecturers to plan their weekly teaching schedule. +

There are many ways to improve and extend the functionality of this software and this guide provides essential information to help you get started.
This developer guide contains information of the architecture design of this software, implementation of the existing commands that is accessible for the
users and other useful information such as guide to teach you how to test this software. For more information please refer
to the table of content.
// end::intro[]

== Setting up

=== Prerequisites

. *JDK `1.8.0_60`* or later
+
[NOTE]
Having any Java 8 version is not enough. +
This app will not work with earlier versions of Java 8.
+

. *IntelliJ* IDE
+
[NOTE]
IntelliJ by default has link:#gradle[Gradle] and link:#javaFX[JavaFX] plugins installed. +
Do not disable them. If you have disabled them, go to `File` > `Settings` > `Plugins` to re-enable them.


=== Setting up the project in your computer

. Fork this repo, and clone the fork to your computer
. Open IntelliJ (if you are not in the welcome screen, click `File` > `Close Project` to close the existing project dialog first)
. Set up the correct JDK version for link:#gradle[Gradle]
.. Click `Configure` > `Project Defaults` > `Project Structure`
.. Click `New...` and find the directory of the JDK
. Click `Import Project`
. Locate the `build.gradle` file and select it. Click `OK`
. Click `Open as Project`
. Click `OK` to accept the default settings
. Open a console and run the command `gradlew processResources` (Mac/Linux: `./gradlew processResources`). It should finish with the `BUILD SUCCESSFUL` message. +
This will generate all resources required by the application and tests.

=== Verifying the setup

. Run the `seedu.address.MainApp` and try a few commands
. link:#testing[Run the tests] to ensure they all pass.

=== Configurations to do before writing code

==== Configuring the coding style

This project follows https://github.com/oss-generic/process/blob/master/docs/CodingStandards.md[oss-generic coding standards]. IntelliJ's default style is mostly compliant with ours but it uses a different import order from ours. To rectify,

. Go to `File` > `Settings...` (Windows/Linux), or `IntelliJ IDEA` > `Preferences...` (macOS)
. Select `Editor` > `Code Style` > `Java`
. Click on the `Imports` tab to set the order

* For `Class count to use import with '\*'` and `Names count to use static import with '*'`: Set to `999` to prevent IntelliJ from contracting the import statements
* For `Import Layout`: The order is `import static all other imports`, `import java.\*`, `import javax.*`, `import org.\*`, `import com.*`, `import all other imports`. Add a `<blank line>` between each `import`

Optionally, you can follow the <<UsingCheckstyle#, UsingCheckstyle.adoc>> document to configure Intellij to check style-compliance as you write code.

==== Setting up CI

Set up link:#travis[Travis] to perform Continuous Integration (CI) for your fork. See <<UsingTravis#, UsingTravis.adoc>> to learn how to set it up.

Optionally, you can set up AppVeyor as a second CI (see <<UsingAppVeyor#, UsingAppVeyor.adoc>>).

[NOTE]
Having both link:#travis[Travis] and AppVeyor ensures your App works on both Unix-based platforms and Windows-based platforms (Travis is Unix-based and AppVeyor is Windows-based)

==== Getting started with coding

When you are ready to start coding,

1. Get some sense of the overall design by reading the link:#architecture[Architecture] section.
2. Take a look at the section link:#suggested-programming-tasks-to-get-started[Suggested Programming Tasks to Get Started].

== Design

=== Architecture

image::Architecture.png[width="600"]
_Figure 2.1.1 : Architecture Diagram_

The *_Architecture Diagram_* given above explains the high-level design of the App. Given below is a quick overview of each component.

[TIP]
The `.pptx` files used to create diagrams in this document can be found in the link:{repoURL}/docs/diagrams/[diagrams] folder. To update a diagram, modify the diagram in the pptx file, select the objects of the diagram, and choose `Save as picture`.

`Main` has only one class called link:{repoURL}/src/main/java/seedu/address/MainApp.java[`MainApp`]. It is responsible for,

* At app launch: Initializes the components in the correct sequence, and connects them up with each other.
* At shut down: Shuts down the components and invokes cleanup method where necessary.

link:#common-classes[*`Commons`*] represents a collection of classes used by multiple other components. Two of those classes play important roles at the architecture level.

* `EventsCenter` : This class (written using https://github.com/google/guava/wiki/EventBusExplained[Google's Event Bus library]) is used by components to communicate with other components using events (i.e. a form of _Event Driven_ design)
* `LogsCenter` : Used by many classes to write log messages to the App's log file.

The rest of the App consists of four components.

* link:#ui-component[*`UI`*] : The link:#ui[UI] of the App.
* link:#logic-component[*`Logic`*] : The command executor.
* link:#model-component[*`Model`*] : Holds the data of the App in-memory.
* link:#storage-component[*`Storage`*] : Reads data from, and writes data to, the hard disk.

Each of the four components

* Defines its _link:#api[API]_ in an `interface` with the same name as the Component.
* Exposes its functionality using a `{Component Name}Manager` class.

For example, the `Logic` component (see the link:#class-diagram[class diagram] given below) defines it's link:#api[API] in the `Logic.java` interface and exposes its functionality using the `LogicManager.java` class.

image::LogicClassDiagram.png[width="800"]
_Figure 2.1.2 : link:#class-diagram[Class Diagram] of the Logic Component_

[discrete]
==== Events-Driven nature of the design

The _link:#sequence-diagram[Sequence Diagram]_ below shows how the components interact for the scenario where the user issues the command `delete 1`.

image::SDforDeletePerson.png[width="800"]
_Figure 2.1.3a : Component interactions for `delete 1` command (part 1)_

[NOTE]
Note how the `Model` simply raises a `AddressBookChangedEvent` when the ModU data are changed, instead of asking the `Storage` to save the updates to the hard disk.

The diagram below shows how the `EventsCenter` reacts to that event, which eventually results in the updates being saved to the hard disk and the status bar of the link:#ui[UI] being updated to reflect the 'Last Updated' time.

image::SDforDeletePersonEventHandling.png[width="800"]
_Figure 2.1.3b : Component interactions for `delete 1` command (part 2)_

[NOTE]
Note how the event is propagated through the `EventsCenter` to the `Storage` and `UI` without `Model` having to be coupled to either of them. This is an example of how this Event Driven approach helps us reduce direct coupling between components.

The sections below give more details of each component.

=== link:#ui[UI] component

image::UiClassDiagram.png[width="800"]
_Figure 2.2.1 : Structure of the link:#ui[UI] Component_

*link:#api[API]* : link:{repoURL}/src/main/java/seedu/address/ui/Ui.java[`Ui.java`]

The link:#ui[UI] consists of a `MainWindow` that is made up of parts e.g.`CommandBox`, `ResultDisplay`, `PersonListPanel`, `StatusBarFooter`, `BrowserPanel` etc. All these, including the `MainWindow`, inherit from the abstract `UiPart` class.

The `link:#ui[UI]` component uses link:#javaFX[JavaFX] link:#ui[UI] framework. The layout of these link:#ui[UI] parts are defined in matching `.fxml` files that are in the `src/main/resources/view` folder. For example, the layout of the link:{repoURL}/src/main/java/seedu/address/ui/MainWindow.java[`MainWindow`] is specified in link:{repoURL}/src/main/resources/view/MainWindow.fxml[`MainWindow.fxml`]

The `link:#ui[UI]` component,

* Executes user commands using the `Logic` component.
* Binds itself to some data in the `Model` so that the link:#ui[UI] can auto-update when data in the `Model` change.
* Responds to events raised from various parts of the App and updates the link:#ui[UI] accordingly.

=== Logic component

image::LogicClassDiagram.png[width="800"]
_Figure 2.3.1 : Structure of the Logic Component_

image::LogicCommandClassDiagram.png[width="800"]
_Figure 2.3.2 : Structure of Commands in the Logic Component. This diagram shows finer details concerning `XYZCommand` and `Command` in Figure 2.3.1_

*link:#api[API]* :
link:{repoURL}/src/main/java/seedu/address/logic/Logic.java[`Logic.java`]

.  `Logic` uses the `AddressBookParser` class to parse the user command.
.  This results in a `Command` object which is executed by the `LogicManager`.
.  The command execution can affect the `Model` (e.g. adding a lesson) and/or raise events.
.  The result of the command execution is encapsulated as a `CommandResult` object which is passed back to the `Ui`.

Given below is the link:#sequence-diagram[Sequence Diagram] for interactions within the `Logic` component for the `execute("delete 1")` link:#api[API] call.

image::DeletePersonSdForLogic.png[width="800"]
_Figure 2.3.1 : Interactions Inside the Logic Component for the `delete 1` Command_

=== Model component

image::ModelClassDiagram.png[width="800"]
_Figure 2.4.1 : Structure of the Model Component_

*link:#api[API]* : link:{repoURL}/src/main/java/seedu/address/model/Model.java[`Model.java`]

The `Model`,

* stores a `UserPref` object that represents the user's preferences.
* stores the ModU data.
* exposes an unmodifiable `ObservableList<ReadOnlyLesson>` that can be 'observed' e.g. the link:#ui[UI] can be bound to this list so that the link:#ui[UI] automatically updates when the data in the list change.
* does not depend on any of the other three components.

=== Storage component

image::StorageClassDiagram.png[width="800"]
_Figure 2.5.1 : Structure of the Storage Component_

*link:#api[API]* : link:{repoURL}/src/main/java/seedu/address/storage/Storage.java[`Storage.java`]

The `Storage` component,

* can save `UserPref` objects in json format and read it back.
* can save the ModU data in xml format and read it back.

=== Common classes

Classes used by multiple components are in the `seedu.addressbook.commons` package.

== Implementation

This section describes some noteworthy details on how certain features are implemented.

// tag::undoredo[]
=== Undo/Redo mechanism

The undo/redo mechanism is facilitated by an `UndoRedoStack`, which resides inside `LogicManager`. It supports undoing and redoing of commands that modifies the state of the ModU (e.g. `add`, `edit`). Such commands will inherit from `UndoableCommand`.

`UndoRedoStack` only deals with `UndoableCommands`. Commands that cannot be undone will inherit from `Command` instead. The following diagram shows the inheritance diagram for commands:

image::LogicCommandClassDiagram.png[width="800"]

As you can see from the diagram, `UndoableCommand` adds an extra layer between the abstract `Command` class and concrete commands that can be undone, such as the `DeleteCommand`. Note that extra tasks need to be done when executing a command in an _undoable_ way, such as saving the state of the ModU before execution. `UndoableCommand` contains the high-level algorithm for those extra tasks while the child classes implements the details of how to execute the specific command. Note that this technique of putting the high-level algorithm in the parent class and lower-level steps of the algorithm in child classes is also known as the https://www.tutorialspoint.com/design_pattern/template_pattern.htm[template pattern].

Commands that are not undoable are implemented this way:
[source,java]
----
public class ListCommand extends Command {
    @Override
    public CommandResult execute() {
        // ... list logic ...
    }
}
----

With the extra layer, the commands that are undoable are implemented this way:
[source,java]
----
public abstract class UndoableCommand extends Command {
    @Override
    public CommandResult execute() {
        // ... undo logic ...

        executeUndoableCommand();
    }
}

public class DeleteCommand extends UndoableCommand {
    @Override
    public CommandResult executeUndoableCommand() {
        // ... delete logic ...
    }
}
----

Suppose that the user has just launched the application. The `UndoRedoStack` will be empty at the beginning. And the panel is listing all modules.

The user executes a new `UndoableCommand`, `delete 5`, to delete all lessons associate with 5th Module in the ModU. The current state of the ModU is saved before the `delete 5` command executes. The `delete 5` command will then be pushed onto the `undoStack` (the current state is saved together with the command).

image::UndoRedoStartingStackDiagram.png[width="800"]

As the user continues to use the program, more commands are added into the `undoStack`. For example, the user may execute `add m/CS2103T ...` to add a new lesson.

image::UndoRedoNewCommand1StackDiagram.png[width="800"]

[NOTE]
If a command fails its execution, it will not be pushed to the `UndoRedoStack` at all.

The user now decides that adding the lesson was a mistake, and decides to undo that action using `undo`.

We will pop the most recent command out of the `undoStack`, and check if the command is redoable now, we say a command is redoable if the listing panel has not been changed(For example, user type `list location`, then current listing element changed to location from module, or user types in `find MA1101`, then only a selected set of Module is listed.), since command like `delete 5` has different meaning when listing by module and location, redo the command is no longer allowed. However, if the listing element has not been changed, we will push it back to the `redoStack`. We will restore the ModU to the state before the `add` command executed.

image::UndoRedoExecuteUndoStackDiagram.png[width="800"]

[NOTE]
If the `undoStack` is empty, then there are no other commands left to be undone, and an `Exception` will be thrown when popping the `undoStack`.

The following link:#sequence-diagram[sequence diagram] shows how the undo operation works:

image::UndoRedoSequenceDiagram.png[width="800"]

The redo does the exact opposite (pops from `redoStack`, push to `undoStack`, and restores the ModU to the state after the command is executed).

[NOTE]
If the `redoStack` is empty, then there are no other commands left to be redone, and an `Exception` will be thrown when popping the `redoStack`.

The user now decides to execute a new command, `clear`. As before, `clear` will be pushed into the `undoStack`. This time the `redoStack` is no longer empty. It will be purged as it no longer make sense to redo the `add m/MA1101R` command (this is the behavior that most modern desktop applications follow).

image::UndoRedoNewCommand2StackDiagram.png[width="800"]

Commands that are not undoable are not added into the `undoStack`. For example, `list`, which inherits from `Command` rather than `UndoableCommand`, will not be added after execution:

image::UndoRedoNewCommand3StackDiagram.png[width="800"]

Suppose now user wants to view all lessons of Module Code CS2103, thus user types command `view 1`(Suppose the index of Module CS2103 is 1), command `view` will result in listing element changed from `Module` to `Lesson`. Then the `undoStack` is cleared. Because User can only undo if the listing element type has not been switched.

image::UndoRedoNewCommand4StackDiagram.png[width="800"]

The following link:#activity-diagram[activity diagram] summarize what happens inside the `UndoRedoStack` when a user executes a new command:

image::UndoRedoActivityDiagram.png[width="200"]

==== Design Considerations

**Aspect:** Implementation of `UndoableCommand` +
**Alternative 1 (current choice):** Add a new abstract method `executeUndoableCommand()` +
**Pros:** We will not lose any undone/redone functionality as it is now part of the default behaviour. Classes that deal with `Command` do not have to know that `executeUndoableCommand()` exist. +
**Cons:** Hard for new developers to understand the template pattern. +
**Alternative 2:** Just override `execute()` +
**Pros:** Does not involve the template pattern, easier for new developers to understand. +
**Cons:** Classes that inherit from `UndoableCommand` must remember to call `super.execute()`, or lose the ability to undo/redo.

---

**Aspect:** How undo & redo executes +
**Alternative 1 (current choice):** Saves the entire ModU. +
**Pros:** Easy to implement. +
**Cons:** May have performance issues in terms of memory usage. +
**Alternative 2:** Individual command knows how to undo/redo by itself. +
**Pros:** Will use less memory (e.g. for `delete`, just save the lesson being deleted). +
**Cons:** We must ensure that the implementation of each individual command are correct.

---

**Aspect:** Type of commands that can be undone/redone +
**Alternative 1 (current choice):** Only include commands that modifies the ModU (`add`, `clear`, `edit`). +
**Pros:** We only revert changes that are hard to change back (the view can easily be re-modified as no data are lost). +
**Cons:** User might think that undo also applies when the list is modified (undoing filtering for example), only to realize that it does not do that, after executing `undo`. +
**Alternative 2:** Include all commands. +
**Pros:** Might be more intuitive for the user. +
**Cons:** User have no way of skipping such commands if he or she just want to reset the state of the ModU and not the view. +
**Additional Info:** See our discussion  https://github.com/se-edu/addressbook-level4/issues/390#issuecomment-298936672[here].

---

**Aspect:** Data structure to support the undo/redo commands +
**Alternative 1 (current choice):** Use separate stack for undo and redo +
**Pros:** Easy to understand for new Computer Science student undergraduates to understand, who are likely to be the new incoming developers of our project. +
**Cons:** Logic is duplicated twice. For example, when a new command is executed, we must remember to update both `HistoryManager` and `UndoRedoStack`. +
**Alternative 2:** Use `HistoryManager` for undo/redo +
**Pros:** We do not need to maintain a separate stack, and just reuse what is already in the codebase. +
**Cons:** Requires dealing with commands that have already been undone: We must remember to skip these commands. Violates Single Responsibility Principle and Separation of Concerns as `HistoryManager` now needs to do two different things. +
// end::undoredo[]

// tag::ListingUnit[]
=== ListingUnit mechanism

`ListingUnit` is a enumeration class which has enumeration type `LESSON`, `MODULE` and `LOCATION`. It records the current listing element type of the lesson list panel. It has static method `getCurrentListingUnit` and `setCurrentListingUnit`. By which we can conveniently record the current listing type and get the current listing type at any time.
It is implemented in this way:
----

public enum ListingUnit {
    MODULE, LOCATION, LESSON;

    private static ListingUnit currentListingUnit = MODULE;
    private static Predicate currentPredicate;

    //...
}
----
When `list` command is used. The variable `currentListingUnit` will be set accordingly(either `LOCATION` or `MODULE`) in order for future reference of other operation.
Similarly, when `view` command is used, the variable `currentListingUnit` will be set to `LESSON`.

It facilitates the implementation of many parts of `logic component`. Such as `EditCommandParser`, `ViewCommand`, `DeleteCommand` etc.
For example, edit command will need to know the current listing type in order to parse the arguments accordingly, the execution of delete command will need to know the current listing type in order to decide either delete a lesson specified by the index or a collection of lessons specified by the attribute.

`ListingUnit` also records the current predicate used in `filteredLessonList`, it has static method `setCurrentPredicate` and `getCurrentPredicate`.
Whenever the predicate is changed, the variable `currentPredicate` will be updated accordingly.

The recorded predicate is mainly used to facilitate the implementation of `redo` command. As we discussed above about `redo` command. We are not allowing redo the previous command in a different context. Since many of the commands are Index-based, it will have different effects to execute the command again with a different listing.
As a result, when implement the redo mechanism, we can obtain the `currentPredicate` and compare it with the predicate memoried by the command and only push it into the `redostack` if the predicate is the same.

==== Design Considerations

**Aspect:** Implementation of `ListingUnit` +
**Alternative 1 (current choice):**  Construct a enumeration class `ListingUnit` and record current listing type and predicates. +
**Pros:** It makes the implementation of many other features easier. +
**Cons:** In testing, `ListingUnit` class carry data from one test to another even when we want each test to be independent of the others. +
**Alternative 2 (previous choice):** Use a variable in model manager to keep record of currentListingUnit +
**Pros:** No need for extra enumeration class. +
**Cons:** In order to access the variable in other components, the variable must be declared static. But we cannot define static abstract method in interface.
// end::ListingUnit[]

// tag::list/view[]
=== List/View mechanism
The list and view mechanisms are similar and both are facilitated by `ListingUnit` and `Predicate`.
When user list by different attributes, the static variable `currentListingUnit` will be reset to either `MODULE` or `LOCATION`.
When user view by index, the the static variable `currentListingUnit` will be set to `LESSON`.

[NOTE]
The default listing is to list all modules. When list by attribute, for example, `list location`, the currentListingUnit will be set to `location` and show a list of all locations.

For different listing type, we always use the same lessonList but set different `Predicate` to it.
`UniqueModuleCodePredicate` and `UniqueLocationPredicate` are used to facilitate the implementation of list.
For example, when user types in `list module`, a `UniqueModulePredicate` will be used to filter the lessonList and UI will hide all other irrelevant information of the lesson and results in showing a list of all Modules.

The following link:#sequence-diagram[sequence diagram] shows how the list command works:

image::ListCommandSequenceDiagram.jpg[width="900"]

The following link:#activity-diagram[activity diagram] summarize what happens when an user execute list command.

image::ListCommandActivityDiagram.png[width="900"]

`FixedCodePredicate` and `FixedLocationPredicate` are used to facilitate the implementation of `view` command.
According to current listing type, which we can obtain from `ListingUnit`, we create either a `FixedCodePredicate` or a `FixedLocationPredicate` to filter the lesson list and set `currentListingUnit` to be `Lesson`.

The following link:#sequence-diagram[sequence diagram] shows how the view command works:

image::ViewCommandSequenceDiagram.jpg[width="900"]

The following link:#activity-diagram[activity diagram] summarize what happens when an user execute view command.

image::ViewCommandActivityDiagram.png[width="900"]

==== Design Considerations

**Aspect:** Implementation of `List` and `View` +
**Alternative 1 (current choice):**  set different predicates to the `filteredList` and hide irrelevant information in the panel. +
**Pros:** Easy to understand and do not use extra space to store different kinds of lists(For example, location list). +
**Cons:** Overhead of setting predicates repeatedly. +
**Alternative 2 (previous choice):** Store lesson list, unique module list and unique location list separately. and switch to different panel list and view command is called. +
**Pros:** More well-organized structure. +
**Cons:** Much harder to implement and overhead of switching to different panels instead of using one.

// end::list/view[]

// tag::mark/unmark[]
=== Mark/Unmark mechanism

The mark mechanism is facilitated by an extra attribute `isMarked` of `Lesson` class. `isMarked` is a boolean attribute which indicates if the given lesson is in the marked list.

When user `mark` a lesson. The `isMarked` attribute of the specified lesson will be set to `true`.
When user `unmark` a lesson, the `isMarked` attribute of the specified lesson will be set to `false`.

When a new lesson is added. By default it is not in the marked list thus the `isMarked` filed will be set to false.

The following link:#sequence-diagram[sequence diagram] shows how the mark command works:

image::MarkCommandSequenceDiagram.jpg[width="900"]

You can see a list of all marked lesson by command `list marked`.

[NOTE]
Each lesson is only allowed to be added into the `marked list` once, thus any further `mark` attempt will cause an exception being thrown.

==== Design Considerations

**Aspect:** Implementation of mark/unmark. +
**Alternative 1 (current choice):**  Create an extra attribute `isMarked` for each lesson to record if the lesson is in the `marked list`.
**Pros:** Easy to implement `list marked` since we are always using predicates to update the lesson list showing. +
**Cons:** Need to filter out marked lessons every time. +
**Alternative 2 (previous choice):** Store an extra marked lesson list. +
**Pros:** We do not need to filter out the marked lessons each time. +
**Cons:** Inefficient storage, many lessons might be stored multiple times.

// end::mark/remark[]

// tag::find[]
=== Find mechanism

The find mechanism is facilitated by predicates. Whenever find command is executed, in `FindCommandParser` will turn the paramater into a string list which will pass to the `FindCommand`.
In `FindCommand` different find predicate will be called depends on what the current `ListingUnit` is and will update the predicate of `filteredList` with one of these three predicates.
`LocationContainsKeywordPredicate` which find the lessons with name that contains the keywords, `ModuleContainsKeywordPredicate` which find lesson with module code that contains the keyword and
, `MarkedLessonContainsKeywordPredicate` which find the marked lessons with name that contains the keywords and
finally `LessonContainsKeywordPredicate` which find lessons with any information they have that contains the keywords.

[NOTE]
`LocationContainsKeywordPredicate` will be used when the current `ListingUnit` is `LOCATION`. +
`ModuleContainsKeywordPredicate` will be used when the current `ListingUnit` is `MODULE`. +
`MarkedLessonContainsKeywordPredicate` will be used when the current `ListingUnit` is `LESSON` and `currentViewingPredicate` is `marked`.
`LessonContainsKeywordPredicate` will be used when the current `ListingUnit` is `LESSON`.

The following link:#sequence-diagram[sequence diagram] shows how the find operation works:

image::FindCommandSeqDiagram.png[width="900"]

The redo does the exact opposite (pops from `redoStack`, push to `undoStack`, and restores the address book to the state after the command is executed).

The following link:#activity-diagram[activity diagram] summarize what happens when an user execute find command.

image::FindCommandActivityDiagram.png[width="900"]

==== Design Considerations

**Aspect:** Implementation of `FindCommand` +
**Alternative 1 (current choice):** Find module/lesson/location base on the current `ListingUnit`. +
**Pros:** Make more sense to implement this way as in ModU as user do not always view all lessons in `LessonListPanel`.
It will not make sense for the user to find something that is not currently in `LessonListPanel`. +
**Cons:** More work need to be done as implementing `FindCommand` this way would need to create multiple `Predicates` for different type of `ListCommand` attributes. +
**Alternative 2:** Find lesson based on the full list regardless which previous `ListCommand` attribute. +
**Pros:** Less work. +
**Cons:** Make no sense for user as the `FindCommand` will return something that is irrelevant for the user.
 For example, the `LessonListingPanel` shows a list of modules and the user want to search for module "CS1010", the `FindCommand`
 will return a list of "CS1010" lessons instead of the module the user is trying to look for. +

// end::find[]

// tag::remark[]
===  Remark mechanism

The remark mechanism is facilitated by `UniqueRemarkList`. Each time we add or delete a remark, the UniqueRemarkList is updated and changes are saved into storage.
A filtered list is used to show remarks related to a specified module when a module is selected.

[NOTE]
Only module can be remarked, therefore user can use remark if and only if current listing element is module.
Both adding a remark and deleting a remark used an index while the meaning of the index is different.
The index in `remark INDEX CONTENT` is the index of the module in the module list we want to add remark to.
While the index in `delete -d INDEX` is the index of the remark we want to delete.

The following link:#sequence-diagram[sequence diagram] summarize what happens when an user execute remark command.

image::RemarkCommandSequenceDiagram.jpg[width="900"]

The following link:#activity-diagram[activity diagram] summarize what happens when an user execute remark command.

image::RemarkCommandActivityDiagram.png[width="900"]

==== Design Considerations

**Aspect:** Implementation of RemarkCommand +
**Alternative 1 (current choice):** use a `uniqueRemarkList` similar to `uniqueLessonList`. +
**Pros:** Store all remarks as a single list thus it is easy to manage.
**Cons:** Need to filter out a selected set of remarks when user select a specific module.
// end::remark[]

// tag::sort[]
=== Sort mechanism

The sort mechanism is facilitated by link:#event-bus[`Event Bus`]. Whenever sort command is executed, in `SortCommand` it will raise a `SortListRequestEvent` via `EventCenter` which there is an listerner in `PersonListPanel` which will conduct the sorting list according to the attribute type of `list` command which was executed previously.

[NOTE]
If the previous attribute type of `list` command is location, the list will be sorted by person's address lexicographically, such sorting will also be applied for attribute email and phone. If there is no attribute in the execution of previous `list` command, the list will be sorted by person's name lexicographically by default.

The following link:#sequence-diagram[sequence diagram] shows how the sort operation works:

image::SortCommandSeqDiagram.png[width="900"]

The redo does the exact opposite (pops from `redoStack`, push to `undoStack`, and restores the address book to the state after the command is executed).

The following link:#activity-diagram[activity diagram] summarize what happens when an user execute sort command.

image::sortCommandactivitydiagram.png[width="900"]

==== Design Considerations

**Aspect:** Implementation of `SortCommand` +
**Alternative 1 (current choice):** Sort the actual `internalList` in `UniqueLessonList`. +
**Pros:** Easier for new developer to understand the operation of SortCommand execution as it is more intuitive. Prevent conflicting with other command execution which use the `internalList`. +
**Cons:** More work as need to create different level of abstraction in model for a single method. +
**Alternative 2:** Sort list by calling event to sort the current Observable<ReadOnlyLesson> lesson list on `LessonListPanel`. +
**Pros:** This implementation requires lesser work compare to alternative 1. +
**Cons:** Could be counter intuitive for new developer who is looking at the code for the first time as normally developers would relate such execution in the `Model` component of this product. In additional, this will make the `internalList` to be different with the `list` users see on the `LessonListPanel` which sill make other command operate to not operate properly. +

---

**Aspect:** How sort executes +
**Alternative 1 (current choice):** Sort exiting list base on the attribute type of previous `List` command called. +
**Pros:** Make more sense as if address attribute was provided as parameter for previous `List` command, the existing list before sort been execute will only shown a list addresses. +
**Cons:** Need to find out with attribute type was given as parameter for previous `List` command and sort accordingly which amount to more work. +
**Alternative 2:** Despite the previous `List` attribute type and return a list with all the details from all attributes and sorted by name. +
**Pros:** Less work. +
**Cons:** `Sort` command will not go hand in hand with `List` command.
// end::sort[]

// tag::colorKeyword[]
=== Color Keyword mechanism

The color keyword mechanism is facilitated by link:#event-bus[`Event Bus`]. Whenever color keyword command is executed, in `ColorKeywordCommand` it will raise a `ColorKeywordEvent` via `EventCenter` which there is an listener in `CommandBox` which will enable/disable the highlighting of command keyword feature according to the parameter which was passed in by the user.

[NOTE]
The default setting for this feature is set as disable.

The following link:#sequence-diagram[sequence diagram] shows how the color keyword command operation works:

image::ColorKeywordCommandSeqDiagram.png[width="900"]

The following link:#sequence-diagram[activity diagram] summarize what happens when an user execute color keyword command.

image::ColorKeywordActivityDiagram.png[width="900"]

The following diagram shows what happens in the `configBorderColor` method in detail:

image::configBorderColor.png[width="900"]

==== Design Considerations

**Aspect:** Implementation of `ColorKeywordCommand` +
**Alternative 1 (current choice):**  Update boolean variable "isEnable" in the command box by calling event to set the status of this variable. +
**Pros:** Since only command box will be updated, using event center will maintain a good data encapsulation. +
**Cons:** Hard for new developers to understand the event center mechanism. +
**Alternative 1 (current choice):** Declare a global boolean variable +
**Pros:** Easier for new developer to design +
**Cons:** This method breaks encapsulation and fails to follow standard java code style.
// end::colorKeyword[]

// tag::customise[]
=== Customise mechanism

The customise mechanism is facilitated by both the link:#event-bus[`Event Bus`] and an enumeration class `FontSizeUnit`. Currently, `CustomiseCommand` only supports changing the font size of the application. Each time `CustomiseCommand` is executed, it will raise a `ChangedFontSizeEvent` via `EventCenter` according to the user specified parameter as well as update the `currentFontSizeUnit`.

[NOTE]
The `FontSizeUnit` enumeration is to set a global static variable `currentFontSizeUnit` so that `PersonCard` is able to follow the current font size whenever it is called.

The following link:#sequence-diagram[sequence diagram] shows how the customise command operation works:

image::CustomiseCommandSeqDiagram.png[width="900"]

The following link:#sequence-diagram[activity diagram] summarize what happens when a user execute customise command.

image::CustomiseCommandActivityDiagram.png[width="900"]

==== Design Considerations

**Aspect:** Implementation of `CustomiseCommand` +
**Alternative 1 (current choice):** Update static variable `currentFontSizeUnit` to the corresponding `FontSizeUnit` and use `EventBus` to inform `UI` the change of `fontSizeUnit`.
**Pros:** One global variable that records current `fontSizeUnit`. +
**Cons:** Hard for new developers to understand the event center mechanism. +
**Alternative 2 (previous choice):** Use a variable in model manager to keep record of `currentFontSizeUnit` +
**Pros:** No need for extra enumeration class and easier for new developers to design. +
**Cons:** In order to get it in other components, the variable must be declared static. But we cannot define static abstract method in interface. It also does not follow Java's standard coding style.
// end::customise[]

// tag::theme[]
=== Switch theme mechanism

The switch theme mechanism is facilitated by both the link:#event-bus[`Event Bus`] and an enumeration class `ThemeUnit`. Currently, `ThemeCommand` only supports changing between light (default) and dark theme. Each time `ThemeCommand` is executed, it will raise a `SwitchThemeRequestEvent` via `EventCenter` and update the `currentThemeUnit`.

[NOTE]
The `ThemeUnit` enumeration is to set a global static variable `currentThemeUnit` so that `MainWindow` is able to obtain the current theme whenever it is called.

The following link:#sequence-diagram[sequence diagram] shows how the switch theme command operation works:

image::SwitchThemeSeqDiagram.png[width="900"]

The following link:#sequence-diagram[activity diagram] summarize what happens when a user execute switch theme command.

image::SwitchThemeCommandActivityDiagram.png[width="900"]

==== Design Considerations

**Aspect:** Implementation of `ThemeCommand` +
**Alternative 1 (current choice):** Update static variable `currentThemeUnit` to the corresponding `ThemeUnit` and use `EventBus` to inform `UI` the change of `ThemeUnit`.
**Pros:** One global variable that records current `ThemeUnit`. +
**Cons:** Hard for new developers to understand the event center mechanism. +
**Alternative 2 (previous choice):** Use a variable in model manager to keep record of `currentThemeUnit` +
**Pros:** No need for extra enumeration class and easier for new developers to design. +
**Cons:** In order to get it in other components, the variable must be declared static. But we cannot define static abstract method in interface. It also does not follow Java's standard coding style.
// end::theme[]

=== Logging

We are using `java.util.logging` package for logging. The `LogsCenter` class is used to manage the logging levels and logging destinations.

* The logging level can be controlled using the `logLevel` setting in the configuration file (See link:#configuration[Configuration])
* The `Logger` for a class can be obtained using `LogsCenter.getLogger(Class)` which will log messages according to the specified logging level
* Currently log messages are output through: `Console` and to a `.log` file.

*Logging Levels*

* `SEVERE` : Critical problem detected which may possibly cause the termination of the application
* `WARNING` : Can continue, but with caution
* `INFO` : Information showing the noteworthy actions by the App
* `FINE` : Details that is not usually noteworthy but may be useful in debugging e.g. print the actual list instead of just its size

=== Configuration

Certain properties of the application can be controlled (e.g App name, logging level) through the configuration file (default: `config.json`).

== Documentation

We use asciidoc for writing documentation.

[NOTE]
We chose asciidoc over Markdown because asciidoc, although a bit more complex than Markdown, provides more flexibility in formatting.

=== Editing Documentation

See <<UsingGradle#rendering-asciidoc-files, UsingGradle.adoc>> to learn how to render `.adoc` files locally to preview the end result of your edits.
Alternatively, you can download the AsciiDoc plugin for IntelliJ, which allows you to preview the changes you have made to your `.adoc` files in real-time.

=== Publishing Documentation

See <<UsingTravis#deploying-github-pages, UsingTravis.adoc>> to learn how to deploy GitHub Pages using link:#travis[Travis].

=== Converting Documentation to PDF format

We use https://www.google.com/chrome/browser/desktop/[Google Chrome] for converting documentation to PDF format, as Chrome's PDF engine preserves hyperlinks used in webpages.

Here are the steps to convert the project documentation files to PDF format.

.  Follow the instructions in <<UsingGradle#rendering-asciidoc-files, UsingGradle.adoc>> to convert the AsciiDoc files in the `docs/` directory to HTML format.
.  Go to your generated HTML files in the `build/docs` folder, right click on them and select `Open with` -> `Google Chrome`.
.  Within Chrome, click on the `Print` option in Chrome's menu.
.  Set the destination to `Save as PDF`, then click `Save` to save a copy of the file in PDF format. For best results, use the settings indicated in the screenshot below.

image::chrome_save_as_pdf.png[width="300"]
_Figure 5.6.1 : Saving documentation as PDF files in Chrome_

== Testing

=== Running Tests

There are three ways to run tests.

[TIP]
The most reliable way to run tests is the 3rd one. The first two methods might fail some link:#gui[GUI] tests due to platform/resolution-specific idiosyncrasies.

*Method 1: Using IntelliJ JUnit test runner*

* To run all tests, right-click on the `src/test/java` folder and choose `Run 'All Tests'`
* To run a subset of tests, you can right-click on a test package, test class, or a test and choose `Run 'ABC'`

*Method 2: Using link:#gradle[Gradle]*

* Open a console and run the command `gradlew clean allTests` (Mac/Linux: `./gradlew clean allTests`)

[NOTE]
See <<UsingGradle#, UsingGradle.adoc>> for more info on how to run tests using link:#gradle[Gradle].

*Method 3: Using link:#gradle[Gradle] (headless)*

Thanks to the https://github.com/TestFX/TestFX[TestFX] library we use, our link:#gui[GUI] tests can be run in the _headless_ mode. In the headless mode, GUI tests do not show up on the screen. That means the developer can do other things on the Computer while the tests are running.

To run tests in headless mode, open a console and run the command `gradlew clean headless allTests` (Mac/Linux: `./gradlew clean headless allTests`)

=== Types of tests

We have two types of tests:

.  *link:#gui[GUI] Tests* - These are tests involving the link:#gui[GUI]. They include,
.. _System Tests_ that test the entire App by simulating user actions on the link:#gui[GUI]. These are in the `systemtests` package.
.. _Unit tests_ that test the individual components. These are in `seedu.address.ui` package.
.  *Non-link:#gui[GUI] Tests* - These are tests not involving the link:#gui[GUI]. They include,
..  _Unit tests_ targeting the lowest level methods/classes. +
e.g. `seedu.address.commons.StringUtilTest`
..  _Integration tests_ that are checking the integration of multiple code units (those code units are assumed to be working). +
e.g. `seedu.address.storage.StorageManagerTest`
..  Hybrids of unit and integration tests. These test are checking multiple code units as well as how the are connected together. +
e.g. `seedu.address.logic.LogicManagerTest`


=== Troubleshooting Testing
**Problem: `HelpWindowTest` fails with a `NullPointerException`.**

* Reason: One of its dependencies, `UserGuide.html` in `src/main/resources/docs` is missing.
* Solution: Execute link:#gradle[Gradle] task `processResources`.

== Dev Ops

=== Build Automation

See <<UsingGradle#, UsingGradle.adoc>> to learn how to use link:#gradle[Gradle] for build automation.

=== Continuous Integration

We use https://travis-ci.org/[Travis CI] and https://www.appveyor.com/[AppVeyor] to perform _Continuous Integration_ on our projects. See <<UsingTravis#, UsingTravis.adoc>> and <<UsingAppVeyor#, UsingAppVeyor.adoc>> for more details.

=== Making a Release

Here are the steps to create a new release.

.  Update the version number in link:{repoURL}/src/main/java/seedu/address/MainApp.java[`MainApp.java`].
.  Generate a JAR file <<UsingGradle#creating-the-jar-file, using Gradle>>.
.  Tag the repo with the version number. e.g. `v0.1`
.  https://help.github.com/articles/creating-releases/[Create a new release using GitHub] and upload the JAR file you created.

=== Managing Dependencies

A project often depends on third-party libraries. For example, ModU depends on the http://wiki.fasterxml.com/JacksonHome[Jackson library] for XML parsing. Managing these _dependencies_ can be automated using link:#gradle[Gradle]. For example, link:#gradle[Gradle] can download the dependencies automatically, which is better than these alternatives. +
a. Include those libraries in the repo (this bloats the repo size) +
b. Require developers to download those libraries manually (this creates extra work for developers)

[appendix]
== User Stories

Priorities: High (must have) - `* * \*`, Medium (nice to have) - `* \*`, Low (unlikely to have) - `*`

[width="59%",cols="22%,<23%,<25%,<30%",options="header",]
|=======================================================================
|Priority |As a ... |I want to ... |So that I can...
|`* * *` |admin |add new module into the system |I can allow the teachers and students to access this new module

|`* * *` |admin |add new teachers into the system |I can allow new teachers to access the software

|`* * *` |admin |list the existing modules |I can view how many and what module do i have in the system

|`* * *` |admin |update the detail of the existing module |I can make changes to the module without having to delete the module and recreate it

|`* * *` |admin |delete teachers from the system |I can take away the access right of the teachers who are no longer working for the school

|`* * *` |admin |update the detail of the teachers |I can make changes of the detail of the teachers without having to delete and recreate them

|`* * *` |admin |view the commands/function i can use in this software |I no need to memorise the function in this software and can review them conviencely whenever i want

|`* * *` |admin |add new location |I can update the list of location in the system whenever a new location is constructed

|`* *` |admin |find a particular lecturer |I no need to search manually in the list of teachers

|`* *` |admin |generate comprehensive reports of the current semester detail |I can save time from making this report myself

|`* *` |admin |view the history of commands |so I no need to go through the list to know what I have added so far

|`* * *` |student |check location and time slot of different modules |I can make my study plan

|`* * *` |student |view all modules that are available next semester |I plan what module I would like to take next semester

|`* * *` |teacher |add new timeslot in timetable |I can plan my teaching schedule

|`* * *` |teacher |delete an existing module in a particular time slot |I can make changes to the time slot

|`* * *` |teacher |delete an existing module in a particular location |I can make changes to the time slot

|`* * *` |teacher |update an existing module time slot |I can change the current time slot to an updated one

|`* * *` |teacher |update an existing module location |I can change the current location to an updated one

|`* * *` |teacher |list all the locations |I know all the locations I can choose from

|`* * *` |teacher |view the help file  |I know all the available functions

|`* * *` |teacher |view available slots at a specified location |I can determine if i can schedule my lecture there

|`* * *` |teacher |login with my username/password |I can secure the information in my account

|`* * *` |teacher |register with username/password |I can gain access to the personalised timetable

|`* *` |teacher |undo the previous command |I can revert to the previous state

|`* *` |teacher |redo the previously undo-ed command |I can revert to the previous state

|`* *` |teacher |show history of commands |I know what my previous commands were

|`* *` |teacher |back up my file |I can retrieve back data

|`* *` |teacher/student |export the timetable to various files (pdf, excel, png, jpeg) |I can print the timetable

|`* *` |teacher/student |report bugs to developers | developer can solve the bug and improve the product

|`* *` |teacher/student |bookmark a particular module |I can have easy access to the particular module

|`* * *` |new user |see usage instructions |refer to instructions when I forget how to use the App

|`* * *` |user |delete a lesson |remove entries that I no longer need

|`* * *` |user |find a lecturer by name |locate details of lecturers without having to go through the entire list

|`* *` |user |hide link:#private-contact-detail[private contact details] by default |minimize chance of someone else seeing them by accident

|`*` |user with many lessons in the ModU |sort lessons by code |locate a lesson easily

|=======================================================================

[appendix]
== Use Cases

(For all use cases below, the *System* is the `ModU` and the *Actor* is the `user`, unless specified otherwise)

[discrete]
=== Use case: Add module to time slot

*MSS*

1. User requests to add module time slot.
2. ModU adds module shows “successfully added” message.
+
Use case ends.

*Extensions*

[none]
* 1a. User enter wrong command format.
+
[none]
** 1a1. ModU shows an error message.
+
Use case ends.

* 2a. The module code, class type, time-slot or location is not available.
+
[none]
** 2a1. ModU shows an error message.
+
Use case ends.

[discrete]
=== Use case: Update module in a particular time slot

*MSS*

1. User requests to list modules.
2. ModU shows a list of modules.
3. User requests to update a specific module in the list.
4. ModU updates the module.
+
Use case ends.

*Extensions*

[none]
* 2a. The list is empty.
+
Use case ends.

* 3a. The module code, class type, time-slot or location is not available.
+
[none]
** 3a1. ModU shows an error message.
+
Use case ends.

[discrete]
=== Use case: Delete module by module/time slot/location

*MSS*

1. User requests to list module by module/time slot/location.
2. ModU shows a list of module/time slot/location.
3. User requests to delete a specific item (module/time slot/location) on the list.
4. ModU deletes the item.
+
Use case ends.

*Extensions*

[none]
* 2a. The list is empty.
+
Use case ends.

* 3a. The given index is invalid.
+
[none]
** 3a1. ModU shows an error message.
+
Use case resumes at step 3.

{More to be added}

[discrete]
=== Use case: Redo command

*MSS*

1.  User requests redo the previously command.
2.  ModU redo previous command.
+
Use case ends.

*Extensions*

[none]
* 2a. Unable to find previous command.
+
Use case ends.

[discrete]
=== Use case: Undo command

*MSS*

1.  User requests to undo previous command.
2.  ModU undo previous command.
+
Use case ends.

*Extensions*

[none]
* 2a. Unable to find previous command.
+
Use case ends.

[discrete]
=== Use case: History

*MSS*

1.  User requests to list history of commands.
2.  ModU shows a list of history of commands.
+
Use case ends.

*Extensions*

[none]
* 2a. The list is empty.
+
Use case ends.

[discrete]
=== Use case: Help

*MSS*

1.  User requests show help guide.
2.  ModU shows help guide.
+
Use case ends.

[discrete]
=== Use case: list

*MSS*

1.  User requests to list all modules time-slots.
2.  ModU shows all modules time-slots.
+
Use case ends.

*Extensions*

[none]
* 2a. The list is empty.
+
Use case ends.

[discrete]
=== Use case: list [tag-name(module / location)]

*MSS*

1. User requests to list by tag-name.
2. ModU shows a list of information by tag-name.
3. User requests to view specific information of tag-name.
+
Use case ends.

*Extensions*

[none]
* 2a. The list is empty.
+
Use case ends.

* 3a. The given index is invalid.
+
[none]
** 3a1. ModU shows an error message.
+
Use case resumes at step 2.

[discrete]
=== Use case: login [userAccount]

*MSS*

1. User requests to login with a User Account.
2. ModU asks user to key in password.
3. User key in password.
4. ModU checks the password and show successful message.
+
Use case ends.

*Extensions*

* 4a. The account is not registered.
+
[none]
** 4a1. ModU shows an error message.
+
Use case ends.

[appendix]
== Non Functional Requirements

   Environment requirement(s):
       .  Should work on any link:#mainstream-os[mainstream OS] as long as it has Java `1.8.0_60` or higher installed.
       .  Minimum 512 MB of RAM memory
       .  Server should have minimum 5 GB of storage size
       .  Compatible with both 32-bits and 64-bits systems

   Capacity
       .  Should be able to hold up to 10000 lessons without a noticeable sluggishness in performance for typical usage.

   Constraint(s)
       .  The system should be backward compatible with data produced by earlier version of the system
       .  The total project cost should not exceed $10,000
       .  A user with above average typing speed for regular English text (i.e. not code, not system admin commands) should be able to accomplish most of the tasks faster using commands than using the mouse.

   Performance requirement(s):
       .  The application should be respond to 1000 people within 2 seconds
       .  Time to restart after failure should not be more than 5 seconds
       .  Screen refresh time should be less than 1 second

   Quality requirement(s):
       .  The system should be usable by a novice who has never used an online timetable planner

   Process requirement(s)
       .  The project is expected to adhere a schedule that delivers an enhancement every week before tutorial.

   Privacy:
       .  Admin have higher access than lecturer as they have to manage the system

   Notes about project scope:
       .  The product is not required to allow users to chat and message with each other

   Portability:
       .  Can be compiled and run in different operating systems and processors

   Security:
       .  The application must preserve the availability, integrity and confidentiality of data

   Reliability:
       .  Data created in the system will be retained for 2 years
       .  System must have less than 1 hour downtime per 3 months (e.g. to update/maintain the system)


[appendix]
== Glossary

[[mainstream-os]]
Mainstream OS

....
Windows, Linux, Unix, OS-X
....

[[private-contact-detail]]
Private contact detail

....
A contact detail that is not meant to be shared with others
....

[[api]]
API

....
An application program interface (API) is code that allows two software programs to communicate with each other. The API defines the correct way for a developer to write a program that requests services from an operating system (OS) or other application. APIs are implemented by function calls composed of verbs and nouns. The required syntax is described in the documentation of the application being called.
....

[[javaFX]]
JavaFX

....
JavaFX is a software platform for creating and delivering desktop applications, as well as rich internet applications (RIAs) that can run across a wide variety of devices. JavaFX is intended to replace Swing as the standard GUI library for Java SE, but both will be included for the foreseeable future.
....

[[gradle]]
Gradle

....
Gradle is a flexible general purpose build tool
....

[[travis]]
Travis

....
Travis CI is a hosted, distributed continuous integration service used to build and test projects hosted at GitHub. Travis CI automatically detects when a commit has been made and pushed to a GitHub repository that is using Travis CI, and each time this happens, it will try to build the project and run tests. This includes commits to all branches, not just to the master branch.
....

[[gui]]
GUI

....
A graphical user interface (GUI) is a human-computer interface (i.e., a way for humans to interact with computers) that uses windows, icons and menus and which can be manipulated by a mouse (and often to a limited extent by a keyboard as well).
....

[[ui]]
UI

....
The user interface (UI), in the industrial design field of human–computer interaction, is the space where interactions between humans and machines occur.
....

[[activity-diagram]]
Activity diagram

....
Activity diagram is basically a flowchart to represent the flow from one activity to another activity.
....

[[class-diagram]]
Class diagram

....
In software engineering, a class diagram in the Unified Modeling Language (UML) is a type of static structure diagram that describes the structure of a system by showing the system's classes, their attributes, operations (or methods), and the relationships among objects.
....

[[sequence-diagram]]
Sequence diagram

....
A sequence diagram is an interaction diagram that shows how objects operate with one another and in what order.
....


[appendix]
== Product Survey

*Product Name*

Author: ...

Pros:

* ...
* ...

Cons:

* ...
* ...
