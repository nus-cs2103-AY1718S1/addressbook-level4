= OurAB - Developer Guide
:toc:
:toc-title:
:toc-placement: preamble
:sectnums:
:imagesDir: images
:stylesDir: stylesheets
ifdef::env-github[]
:tip-caption: :bulb:
:note-caption: :information_source:
endif::[]
ifdef::env-github,env-browser[:outfilesuffix: .adoc]
:repoURL: https://github.com/CS2103AUG2017-F09-B4/addressbook-level4.git

By: `Team F09-B4`      Since: `Sep 2017`      Licence: `MIT`

== Setting up

=== Prerequisites

. *JDK `1.8.0_60`* or later
+
[NOTE]
Having any Java 8 version is not enough. +
This app will not work with earlier versions of Java 8.
+

. *IntelliJ* IDE
+
[NOTE]
IntelliJ by default has Gradle and JavaFx plugins installed. +
Do not disable them. If you have disabled them, go to `File` > `Settings` > `Plugins` to re-enable them.


=== Setting up the project in your computer

. Fork this repo, and clone the fork to your computer
. Open IntelliJ (if you are not in the welcome screen, click `File` > `Close Project` to close the existing project dialog first)
. Set up the correct JDK version for Gradle
.. Click `Configure` > `Project Defaults` > `Project Structure`
.. Click `New...` and find the directory of the JDK
. Click `Import Project`
. Locate the `build.gradle` file and select it. Click `OK`
. Click `Open as Project`
. Click `OK` to accept the default settings
. Open a console and run the command `gradlew processResources` (Mac/Linux: `./gradlew processResources`). It should finish with the `BUILD SUCCESSFUL` message. +
This will generate all resources required by the application and tests.

=== Verifying the setup

. Run the `seedu.address.MainApp` and try a few commands
. link:#testing[Run the tests] to ensure they all pass.

=== Configurations to do before writing code

==== Configuring the coding style

This project follows https://github.com/oss-generic/process/blob/master/docs/CodingStandards.md[oss-generic coding standards]. IntelliJ's default style is mostly compliant with ours but it uses a different import order from ours. To rectify,

. Go to `File` > `Settings...` (Windows/Linux), or `IntelliJ IDEA` > `Preferences...` (macOS)
. Select `Editor` > `Code Style` > `Java`
. Click on the `Imports` tab to set the order

* For `Class count to use import with '\*'` and `Names count to use static import with '*'`: Set to `999` to prevent IntelliJ from contracting the import statements
* For `Import Layout`: The order is `import static all other imports`, `import java.\*`, `import javax.*`, `import org.\*`, `import com.*`, `import all other imports`. Add a `<blank line>` between each `import`

Optionally, you can follow the <<UsingCheckstyle#, UsingCheckstyle.adoc>> document to configure Intellij to check style-compliance as you write code.

==== Updating documentation to match your fork

After forking the repo, links in the documentation will still point to the `OurAB` repo. If you plan to develop this as a separate product (i.e. instead of contributing to `OurAB`) , you should replace the URL in the variable `repoURL` in `DeveloperGuide.adoc` and `UserGuide.adoc` with the URL of your fork.

==== Setting up CI

Set up Travis to perform Continuous Integration (CI) for your fork. See <<UsingTravis#, UsingTravis.adoc>> to learn how to set it up.

Optionally, you can set up AppVeyor as a second CI (see <<UsingAppVeyor#, UsingAppVeyor.adoc>>).

[NOTE]
Having both Travis and AppVeyor ensures your App works on both Unix-based platforms and Windows-based platforms (Travis is Unix-based and AppVeyor is Windows-based)

==== Getting started with coding

When you are ready to start coding,

1. Get some sense of the overall design by reading the link:#architecture[Architecture] section.
2. Take a look at the section link:#suggested-programming-tasks-to-get-started[Suggested Programming Tasks to Get Started].

== Design

=== Architecture

image::Architecture.png[width="600"]
_Figure 2.1.1 : Architecture Diagram_

The *_Architecture Diagram_* given above explains the high-level design of the App. Given below is a quick overview of each component.

[TIP]
The `.pptx` files used to create diagrams in this document can be found in the link:{repoURL}/docs/diagrams/[diagrams] folder. To update a diagram, modify the diagram in the pptx file, select the objects of the diagram, and choose `Save as picture`.

`Main` has only one class called link:{repoURL}/src/main/java/seedu/address/MainApp.java[`MainApp`]. It is responsible for,

* At app launch: Initializes the components in the correct sequence, and connects them up with each other.
* At shut down: Shuts down the components and invokes cleanup method where necessary.

link:#common-classes[*`Commons`*] represents a collection of classes used by multiple other components. Two of those classes play important roles at the architecture level.

* `EventsCenter` : This class (written using https://github.com/google/guava/wiki/EventBusExplained[Google's Event Bus library]) is used by components to communicate with other components using events (i.e. a form of _Event Driven_ design)
* `LogsCenter` : Used by many classes to write log messages to the App's log file.

The rest of the App consists of four components.

* link:#ui-component[*`UI`*] : The UI of the App.
* link:#logic-component[*`Logic`*] : The command executor.
* link:#model-component[*`Model`*] : Holds the data of the App in-memory.
* link:#storage-component[*`Storage`*] : Reads data from, and writes data to, the hard disk.

Each of the four components

* Defines its _API_ in an `interface` with the same name as the Component.
* Exposes its functionality using a `{Component Name}Manager` class.

For example, the `Logic` component (see the class diagram given below) defines it's API in the `Logic.java` interface and exposes its functionality using the `LogicManager.java` class.

image::LogicClassDiagram.png[width="800"]
_Figure 2.1.2 : Class Diagram of the Logic Component_

[discrete]
==== Events-Driven nature of the design

The _Sequence Diagram_ below shows how the components interact for the scenario where the user issues the command `delete 1`.

image::SDforDeletePerson.png[width="800"]
_Figure 2.1.3a : Component interactions for `delete 1` command (part 1)_

[NOTE]
Note how the `Model` simply raises a `AddressBookChangedEvent` when the Address Book data are changed, instead of asking the `Storage` to save the updates to the hard disk.

The diagram below shows how the `EventsCenter` reacts to that event, which eventually results in the updates being saved to the hard disk and the status bar of the UI being updated to reflect the 'Last Updated' time.

image::SDforDeletePersonEventHandling.png[width="800"]
_Figure 2.1.3b : Component interactions for `delete 1` command (part 2)_

[NOTE]
Note how the event is propagated through the `EventsCenter` to the `Storage` and `UI` without `Model` having to be coupled to either of them. This is an example of how this Event Driven approach helps us reduce direct coupling between components.

The sections below give more details of each component.

=== UI component

image::UiClassDiagram.png[width="800"]
_Figure 2.2.1 : Structure of the UI Component_

*API* : link:{repoURL}/src/main/java/seedu/address/ui/Ui.java[`Ui.java`]

The UI consists of a `MainWindow` that is made up of parts e.g.`CommandBox`, `ResultDisplay`, `PersonListPanel`, `StatusBarFooter`, `BrowserPanel` etc. All these, including the `MainWindow`, inherit from the abstract `UiPart` class.

The `UI` component uses JavaFx UI framework. The layout of these UI parts are defined in matching `.fxml` files that are in the `src/main/resources/view` folder. For example, the layout of the link:{repoURL}/src/main/java/seedu/address/ui/MainWindow.java[`MainWindow`] is specified in link:{repoURL}/src/main/resources/view/MainWindow.fxml[`MainWindow.fxml`]

The `UI` component,

* Executes user commands using the `Logic` component.
* Binds itself to some data in the `Model` so that the UI can auto-update when data in the `Model` change.
* Responds to events raised from various parts of the App and updates the UI accordingly.

=== Logic component

image::LogicClassDiagram.png[width="800"]
_Figure 2.3.1 : Structure of the Logic Component_

image::LogicCommandClassDiagram.png[width="800"]
_Figure 2.3.2 : Structure of Commands in the Logic Component. This diagram shows finer details concerning `XYZCommand` and `Command` in Figure 2.3.1_

*API* :
link:{repoURL}/src/main/java/seedu/address/logic/Logic.java[`Logic.java`]

.  `Logic` uses the `AddressBookParser` class to parse the user command.
.  This results in a `Command` object which is executed by the `LogicManager`.
.  The command execution can affect the `Model` (e.g. adding a person) and/or raise events.
.  The result of the command execution is encapsulated as a `CommandResult` object which is passed back to the `Ui`.

Given below is the Sequence Diagram for interactions within the `Logic` component for the `execute("delete 1")` API call.

image::DeletePersonSdForLogic.png[width="800"]
_Figure 2.3.1 : Interactions Inside the Logic Component for the `delete 1` Command_

=== Model component

image::ModelClassDiagram.png[width="800"]
_Figure 2.4.1 : Structure of the Model Component_

*API* : link:{repoURL}/src/main/java/seedu/address/model/Model.java[`Model.java`]

The `Model`,

* stores a `UserPref` object that represents the user's preferences.
* stores the Address Book data.
* stores the meeting list data.
* exposes an unmodifiable `ObservableList<ReadOnlyPerson>` that can be 'observed' e.g. the UI can be bound to this list so that the UI automatically updates when the data in the list change.
* does not depend on any of the other three components.

=== Storage component

image::StorageClassDiagram.png[width="800"]
_Figure 2.5.1 : Structure of the Storage Component_

*API* : link:{repoURL}/src/main/java/seedu/address/storage/Storage.java[`Storage.java`]

The `Storage` component,

* can save `UserPref` objects in json format and read it back.
* can save the Address Book and Meeting List data in xml format and read it back.
* can save a backup of the Address Book and restore from a backup file.

=== Common classes

Classes used by multiple components are in the `seedu.addressbook.commons` package.

== Implementation

This section describes some noteworthy details on how certain features are implemented.

// tag::undoredo[]
=== Undo/Redo mechanism

The undo/redo mechanism is facilitated by an `UndoRedoStack`, which resides inside `LogicManager`. It supports undoing and redoing of commands that modifies the state of the address book (e.g. `add`, `edit`). Such commands will inherit from `UndoableCommand`.

`UndoRedoStack` only deals with `UndoableCommands`. Commands that cannot be undone will inherit from `Command` instead. The following diagram shows the inheritance diagram for commands:

image::LogicCommandClassDiagram.png[width="800"]

As you can see from the diagram, `UndoableCommand` adds an extra layer between the abstract `Command` class and concrete commands that can be undone, such as the `DeleteCommand`. Note that extra tasks need to be done when executing a command in an _undoable_ way, such as saving the state of the address book before execution. `UndoableCommand` contains the high-level algorithm for those extra tasks while the child classes implements the details of how to execute the specific command. Note that this technique of putting the high-level algorithm in the parent class and lower-level steps of the algorithm in child classes is also known as the https://www.tutorialspoint.com/design_pattern/template_pattern.htm[template pattern].

Commands that are not undoable are implemented this way:
[source,java]
----
public class ListCommand extends Command {
    @Override
    public CommandResult execute() {
        // ... list logic ...
    }
}
----

With the extra layer, the commands that are undoable are implemented this way:
[source,java]
----
public abstract class UndoableCommand extends Command {
    @Override
    public CommandResult execute() {
        // ... undo logic ...

        executeUndoableCommand();
    }
}

public class DeleteCommand extends UndoableCommand {
    @Override
    public CommandResult executeUndoableCommand() {
        // ... delete logic ...
    }
}
----

Suppose that the user has just launched the application. The `UndoRedoStack` will be empty at the beginning.

The user executes a new `UndoableCommand`, `delete 5`, to delete the 5th person in the address book. The current state of the address book is saved before the `delete 5` command executes. The `delete 5` command will then be pushed onto the `undoStack` (the current state is saved together with the command).

image::UndoRedoStartingStackDiagram.png[width="800"]

As the user continues to use the program, more commands are added into the `undoStack`. For example, the user may execute `add n/David ...` to add a new person.

image::UndoRedoNewCommand1StackDiagram.png[width="800"]

[NOTE]
If a command fails its execution, it will not be pushed to the `UndoRedoStack` at all.

The user now decides that adding the person was a mistake, and decides to undo that action using `undo`.

We will pop the most recent command out of the `undoStack` and push it back to the `redoStack`. We will restore the address book to the state before the `add` command executed.

image::UndoRedoExecuteUndoStackDiagram.png[width="800"]

[NOTE]
If the `undoStack` is empty, then there are no other commands left to be undone, and an `Exception` will be thrown when popping the `undoStack`.

The following sequence diagram shows how the undo operation works:

image::UndoRedoSequenceDiagram.png[width="800"]

The redo does the exact opposite (pops from `redoStack`, push to `undoStack`, and restores the address book to the state after the command is executed).

[NOTE]
If the `redoStack` is empty, then there are no other commands left to be redone, and an `Exception` will be thrown when popping the `redoStack`.

The user now decides to execute a new command, `clear`. As before, `clear` will be pushed into the `undoStack`. This time the `redoStack` is no longer empty. It will be purged as it no longer make sense to redo the `add n/David` command (this is the behavior that most modern desktop applications follow).

image::UndoRedoNewCommand2StackDiagram.png[width="800"]

Commands that are not undoable are not added into the `undoStack`. For example, `list`, which inherits from `Command` rather than `UndoableCommand`, will not be added after execution:

image::UndoRedoNewCommand3StackDiagram.png[width="800"]

The following activity diagram summarize what happens inside the `UndoRedoStack` when a user executes a new command:

image::UndoRedoActivityDiagram.png[width="200"]

==== Design Considerations

**Aspect:** Implementation of `UndoableCommand` +
**Alternative 1 (current choice):** Add a new abstract method `executeUndoableCommand()` +
**Pros:** We will not lose any undone/redone functionality as it is now part of the default behaviour. Classes that deal with `Command` do not have to know that `executeUndoableCommand()` exist. +
**Cons:** Hard for new developers to understand the template pattern. +
**Alternative 2:** Just override `execute()` +
**Pros:** Does not involve the template pattern, easier for new developers to understand. +
**Cons:** Classes that inherit from `UndoableCommand` must remember to call `super.execute()`, or lose the ability to undo/redo.

---

**Aspect:** How undo & redo executes +
**Alternative 1 (current choice):** Saves the entire address book. +
**Pros:** Easy to implement. +
**Cons:** May have performance issues in terms of memory usage. +
**Alternative 2:** Individual command knows how to undo/redo by itself. +
**Pros:** Will use less memory (e.g. for `delete`, just save the person being deleted). +
**Cons:** We must ensure that the implementation of each individual command are correct.

---

**Aspect:** Type of commands that can be undone/redone +
**Alternative 1 (current choice):** Only include commands that modifies the address book (`add`, `clear`, `edit`). +
**Pros:** We only revert changes that are hard to change back (the view can easily be re-modified as no data are lost). +
**Cons:** User might think that undo also applies when the list is modified (undoing filtering for example), only to realize that it does not do that, after executing `undo`. +
**Alternative 2:** Include all commands. +
**Pros:** Might be more intuitive for the user. +
**Cons:** User have no way of skipping such commands if he or she just want to reset the state of the address book and not the view. +
**Additional Info:** See our discussion  https://github.com/se-edu/addressbook-level4/issues/390#issuecomment-298936672[here].

---

**Aspect:** Data structure to support the undo/redo commands +
**Alternative 1 (current choice):** Use separate stack for undo and redo +
**Pros:** Easy to understand for new Computer Science student undergraduates to understand, who are likely to be the new incoming developers of our project. +
**Cons:** Logic is duplicated twice. For example, when a new command is executed, we must remember to update both `HistoryManager` and `UndoRedoStack`. +
**Alternative 2:** Use `HistoryManager` for undo/redo +
**Pros:** We do not need to maintain a separate stack, and just reuse what is already in the codebase. +
**Cons:** Requires dealing with commands that have already been undone: We must remember to skip these commands. Violates Single Responsibility Principle and Separation of Concerns as `HistoryManager` now needs to do two different things. +
// end::undoredo[]

// tag::meetings[]
=== Meetings

==== Storage

===== Implementation
The mechanism and data structure of meetings are similar to that of the address book. The local storage is located at
`data/meetinglist.xml` by default. For each meeting, the date, time location and participants are recorded. The participants
must be from the address book.


===== Design Considerations

**Aspect:** Local storage of the meeting list +
**Alternative 1 (current choice):** Use XML and separate from the address book storage+
**Pros:** Follows the single responsibility principle and simplifies both the address book and meeting list data structre +
**Cons:** Potentially duplicate code, violates the DRY principle +
**Alternative 2:** Use XML together in the address book storage +
**Pros:** Less extra components needed, some information shared between the two parts can be accessed more conveniently +
**Cons:** The data structure of `addressbook.xml` would become too complicated

---

==== Asana Configuration

===== Implementation of Setup Asana

===== Design Considerations

===== Implementation of Set unique key

===== Design Considerations


==== Add Meeting Command

===== Implementation

When the command is called, the user input is parsed as shown in the sequence diagram below.

image::AddMeetingCommandLogic.png[width="800"]
_Figure 3.2.3.a : Add Meeting Command Parser_

Depending on some conditions:

image::
_Figure 3.2.3.a : Conditions for adding local or online meeting_

There are two primary methods that will be executed:

a. To add unique meetings (ensured by `DuplicateMeetingException`) associated with valid people in +
addressbook (ensured by `IllegalIdException`).

[source, java]
----
    try {
        //..Add local meeting logic..
    } catch (DuplicateMeetingException e) {
        throw new CommandException(MESSAGE_DUPLICATE_MEETING);
    } catch (IllegalIdException ive) {
        throw new CommandException(MESSAGE_INVALID_ID);
    }
----

b. To post a task on Asana
[source, java]
----
    newAsanaTask = new PostTask(..notes.., ..due date..);
    newAsanaTask.execute();
----

Create a new instance of `PostTask` and authenticate user using https://github.com/Asana/java-asana[OAuth2].

===== Design Considerations

**Aspect:** Post on Asana +
**Alternative 1 (current choice):** Incorporate posting on Asana with every addCommand +
**Pros:** Convenient for user to keep track of tasks related to meetings +
**Cons:** Reduces control that user has in uploading tasks to Asana+
**Alternative 2:** Create a separate command to add tasks onto Asana +
**Pros:** More flexibility on the content that is saved onto Asana workspace +
**Cons:** Unnecessary number of commands in the addressbook & reduce productivity of user

=== Logging

We are using `java.util.logging` package for logging. The `LogsCenter` class is used to manage the logging levels and logging destinations.

* The logging level can be controlled using the `logLevel` setting in the configuration file (See link:#configuration[Configuration])
* The `Logger` for a class can be obtained using `LogsCenter.getLogger(Class)` which will log messages according to the specified logging level
* Currently log messages are output through: `Console` and to a `.log` file.

*Logging Levels*

* `SEVERE` : Critical problem detected which may possibly cause the termination of the application
* `WARNING` : Can continue, but with caution
* `INFO` : Information showing the noteworthy actions by the App
* `FINE` : Details that is not usually noteworthy but may be useful in debugging e.g. print the actual list instead of just its size

=== Configuration

Certain properties of the application can be controlled (e.g App name, logging level) through the configuration file (default: `config.json`).

=== Command Box Helper

The command box helper is meant to work similarly to the auto fill functions in IDEs. Two different classes are created, `CommandBoxHelper` and `HelperCard`.
`CommandBoxHelper` contains a ListView which is populated by VBox containers holding the `HelperCard` class. `CommandBoxHelper` retrieves a list of commands and command templates from the `logic` class and performs a check to populate the listview everytime the user enters a key in the command box
The commands are matched using the `contain()` function and comparing the first character of the user's input. Commands that are matched are placed in a list and mapped to their corresponding `HelperCard` classes.
For example, an "add" command will create a new instance of `HelperCard` using "add" as a parameter for the `HelperCard` constructor.

To emulate the behaviour of command helpers in IDEs, the use can also navigate the list of commands using the arrow keys. To prevent it from overwriting the existing code of loading input history, an if-else statement is used. The command box helper takes priority in this case; as long as there is a command
that corresponds to the user's entered string in the CLI, i.e. the command box helper is shown, interaction with the command helper will take precedence over interactions with the CLI. This is implemented similarly in the key inputs `TAB` and `ENTER`, which are used to fill in the CLI after the user has selected his
desired command in the command helper.

==== Design Considerations

**Aspect:** Implementation of the list view in `CommandBoxHelper` +
**Alternative:** Instead of creating a new class to populate the ListView, use a StackPane instead of a ListView and add Strings to it +
**Pros:** Easier to implement the display for command helper +
**Cons:** Fragile architecture, have to change a few functions every time an extra command is added. This involves hardcoding the additional command Strings into the functions.
Slightly harder to display selection of command in the helper box to the user.

// tag::preferences[]
=== Preferences

In addition to configuration, user can customize the address book application by editing preferences. The difference between
configurations and preferences is that configuration stores basic information requried to start the application, while
preferences determine high level functionalities and UI styles. +

==== Implementation
The preferences are stored in `preferences.json` by default. This location is set in `config.json`. When the application
is started, the `initPrefs` method reads the preferences file and converts it into a `UserPrefs` object using jackson-databind
API. +
In `UserPrefs` class, each valid preference key is defined as a field in the class, with initial value set to the default
value of the preference. For example, the default path to the address book local storage is :
[source,java]
----
private String addressBookFilePath = "data/addressbook.xml";
----
There are also two methods defined for each preference: `get<PreferenceKey>` and `set<PreferenceKey>`. These are used for
reading and writing to the preference respectively. For example, for AddressBookFilePath, we have :
[source,java]
----
public String getAddressBookFilePath() {
    return addressBookFilePath;
}

public void setAddressBookFilePath(String addressBookFilePath) {
    this.addressBookFilePath = addressBookFilePath;
}
----

==== Command: `pref`
The `pref` command allows users to view or edit the preferences. The details of its usage can be found in the
<<UserGuide, UserGuide.adoc>>. The implementation of the command will be explained here. +
When a `pref` command is entered, the `PrefCommand` will attempt to find and execute `get<PreferenceKey>`
method in the `UserPrefs` class using Java Reflection API. If an exception is encountered, it is assumed that the method
does not exist and the preference key entered by the user was invalid. Similarly, if two arguments were entered, `PrefCommand`
will again try to find and execute `set<PreferenceKey>` method.

==== Design Considerations

**Aspect:** Implementation of `PrefCommand` +
**Alternative 1 (current choice):** Use Reflection API +
**Pros:** Easier to add in a new preference by changing only the `UserPrefs` class +
**Cons:** Hard to debug since it is less intuitive +
**Alternative 2:** Design another parser similar to the command parser +
**Pros:** Easier to understand the code +
**Cons:** More difficult to add in a new preference

---

**Aspect:** Data structure to store the preferences : +
**Alternative 1 (current choice):** JSON and jackson-databind +
**Pros:** Most of the parsing is taken care of by the API +
**Cons:** Adding new preference is slightly troublesome; the API documentation is not beginner-friendly +
**Alternative 2:** Use a hashmap to store the preferences +
**Pros:** Intuitive, easy to add more preferences +
**Cons:** Data structure is more restricted; may need to write native code to parse JSON if a library cannot be found to convert JSON to hashmap +
// end::preferences[]

=== Command: `List`
Sorts and the lists everyone in the address book in alphabetical order.

==== Implementation

When the `List` command is executed, `UniquePersonList` is sorted lexicographically. +
[source,java]
----
public void sortLexicographically () {
        internalList.sort(new LexicographicComparator());
 }
----
The `LexicographicComparator` compares which person should come before another based on alphabet sequences.
This updates the address book storage file. When model calls for `filteredPersons` list, all persons are read from +
the address book storage and then displayed on `PersonListPanel` on the GUI.


==== Design Considerations

**Aspect:** Persistent sort +
**Alternative 1(current choice):** Persistent sort (Sort persons, by modifying `addressbook.xml`) +
**Pros:** Reduces need for repeated sorting +
**Cons:** Unnecessary operations on storage `addressbook.xml` +
**Alternative 2:** Non-persistent sort (Sort persons in a temporary list) +
**Pros:** Reduce operations on storage file, `Addressbook.xml` +
**Cons:** Use of additional storage to copy all contacts is inefficient in terms of time & storage

---

=== Command: `List By Most Searched`
Sorts and the lists everyone in the address book based on decreasing number of searches.

==== Implementation
Each successful `Search` command execution with non-zero search results, activates an update of search count for everyone in search results.+
[source,java]
----
if (searchResultsCount != NO_RESULTS) {
    model.recordSearchHistory();
}

----
This equates to an update of the search count variable within the `SearchData` class within every `Person` class.
[source,java]
----
public void incrementSearchCount()
----

When the `ListByMostSearched` is executed, `UniquePersonList` is sorted based on descending search count. +
[source,java]
----
public void sortBySearchCount () {
    internalList.sort(new ReadOnlyPersonComparator());
}
----
The `ReadOnlyPersonComparator` compares the search count between two Persons. This updates the address book storage file.
When model calls for `filteredPersons` list, all persons are read from +
the address book storage and then displayed on `PersonListPanel` on the GUI.


==== Design Considerations

**Aspect:** Implementation of storage for `SearchData` +
**Alternative 1 (current choice):** Add `SearchData` as a class in `Person` +
**Pros:** Increase storage efficiency +
**Cons:** `Addressbook.xml` is more complicated
**Alternative 2:** Add `SearchData` to a separate storage file +
**Pros:** Minimal changes to `Addressbook.xml` +
**Cons:** Unnecessary repetition in storage; replication of `Person` details +

---

**Aspect:** Persistent sort +
**Alternative 1(current choice):** Persistent sort (Sort persons, by modifying `addressbook.xml`) +
**Pros:** Reduces need for repeated sorting & speed up `find` command +
**Cons:** Unnecessary operations on storage `addressbook.xml` +
**Alternative 2:** Non-persistent sort (Sort persons in a temporary list) +
**Pros:** Reduce operations on storage file, `Addressbook.xml` +
**Cons:** Use of additional storage to copy all contacts is inefficient in terms of time & storage

---

=== Choosing display mode

This allows the user to select what they want displayed on the main screen. Since our application is targeted at university students to facillitate project meeting, who use a variety of social media
platforms, the ability to select their preferred display is vital so they can view different social media platforms.

==== Implementation

The last selected display mode will be stored in `preferences.json` by default, which is set in `config.json` (coming in v1.4). The default mode of display will be set to `linkedin`.
When a display mode is selected by the user via its command `choose`, an event is raised by the `ChooseCommand` object, via the following line :
[source,java]
----
EventsCenter.getInstance().post(new JumpToBrowserListRequestEvent(targetDisplay));
----
This event is then handled by the `SettingsSelector` object. It selects and highlights the user's selected display mode, and then raises another event :
[source,java]
----
raise(new BrowserPanelSelectionChangedEvent(browserSelection));
----
Which is handled by the `BrowserPanel` object to display their selected display type.

==== Command: `choose`
The `choose` command allows users to select the display type they prefer. When the String found in the command box is detected to contain either `choose` or `pref`, both of which are
commands related to settings, the settings panel is brought in via a translation timeline animation. When the `MainWindow` is originally initialized, the container for the settings panel
is translated on the X axis outside of the application view, and is then brought into view via the animation. When the String in the command box does not contain `choose` or `pref`, the
settings panel is then translated out of sight again.

image::SettingsPaneInOut.png[width="700"]

When the choose command is called, another event is called to hide the other views that are not "chosen" by the user. For example, if the user types in the command `choose meeting`, the root view of the current display page, e.g linkedin, will be removed
from the placeholder in the MainWindow, then the root view of the meeting display is placed in its stead.

image::ChooseSequenceDiagram.png[width="700"]

==== Design Considerations

**Aspect:** Implementation of choose command +
**Alternative:** Combine it with the pref command to come under a "mega" "settings" command. +
**Pros:** Lesser commands for the user to remember, higher code modularity, easier for future command implementations on settings. +
**Cons:** Harder to code and debug due to requirement to parse more arguments

---

**Aspect:** Animation of settings panel +
**Alternative:** Use transitions instead of timeline +
**Pros:** Transitions are easier to implement and understand +
**Cons:** KeyValue objects are fit into a keyframe which is then fit into the timeline, which fits more into the concept of java's OOP and allows for more code reusability when we want to, for example, animate bouncing

---

==== Display LinkedIn Search Results

When the `choose` command is activated with the argument `linkedin`, the `BrowserPanel` handles by calling:
[source, java]
----
private void loadOtherPages(String page);
----

image::LinkedInProfile.png[width="200"]

LinkedIn results page with parameters, such as `Name`, passed in from the selected `Person` class.

Note: Cookies are stored to maintain login session for the length of the addressbook session.

==== Design considerations

**Aspect:** Implementation of display linked in authorisation
**Alternative 1 (current option):** Manual key in of user-id and password into browser
**Pros:** More details of user profile is viewable
**Pros:** More secure
**Cons:** Tedious to type login credentials into browser
**Alternative 2:** Use OAuth 2.0 with LinkedIn Api
**Pros:** More convenient as login credentials are required only once
**Cons:** LinkedIn API available does not allow for viewing of full profile

=== Command: `Delete Tag`

`Delete Tag` lets users delete a particular tag from all users in the address book. +
The feature also allows users to delete multiple tags at the same time.

==== Implementation

The specified arguments `TAG1 TAG2 ...` are parsed to generate an array of `String`.

The generated string array is then used to generate an array of type `Tag`

[source,java]
----
private Tag[] stringToTag (String[] tag);
----

Using this array of type `Tag` as parameter, the `deleteTag` method is executed as follows:

image::deleteTagModelDiagram.png[width="200"]

If `hasOneOrMoreDeletion` is true, user will be notified that tags are successfully deleted. +
Otherwise, users will be notified that specified tags are not used in address book, and thus cannot be deleted.

==== Design Considerations

**Aspect:** implementation of `deleteTag` method in `modelManager`  +
**Alternative 1 (current choice):** Iterate through every person & delete relevant tags +
**Pros:** Increased storage efficiency +
**Cons:** Unnecessary `remove` operations are carried out
**Alternative 2:** Populate list of people with relevant tags & delete relevant tags +
**Pros:** Fewer `remove` operations +
**Cons:** [Space complexity (O(n)) is higher] More storage elements required to store temorary lists +
**Cons:** More complex implementation

---

=== Command: `Search`

`Search` lets users search for contacts in the address book by keywords in their contact details such name, address and telephone number +
The feature is more powerful and useful than find which only searches by name.

==== Implementation

The search command checks the keyword(s) given by the user against any parameters contained in the selected person
[source,java]
----
public boolean test(ReadOnlyPerson person) {
    return keywords.stream()
            .anyMatch(keyword -> StringUtil.containsWordIgnoreCase(person.getAsText(), keyword));
}
----

The keywords are generated as list of strings, which is then checked against the details of the persons
in address book.
[source,java]
----
public PersonContainsKeywordsPredicate(List<String> keywords) {
        this.keywords = keywords;
    }
----

The details are returned as strings, by the ReadOnlyPerson method in the person model. The list of searched
people is then continually updated, before it is finally returned to the user
[source,java]
----
 model.updateFilteredPersonList(predicate);
----

==== Design Considerations

**Aspect:** implementation of `Search` command over `Find`  +
**Pros:** More powerful search tool +
**Cons:** Unnecessary results may be returned for larger address books

---

=== Command: `Map`

Displays the google maps location of a person's address

==== Implementation

When 'map' command is executed, it retrieves the current list of people,
and selects the person's address based on the index given.

[source,java]
----
List<ReadOnlyPerson> lastShownList = model.getFilteredPersonList();

ReadOnlyPerson personToShow = lastShownList.get(index.getZeroBased());
----

The address is then passed into a url template for a page loader to display
the google maps on the browser panel

[source,java]
----
private void loadPersonMap(ReadOnlyPerson person) throws CommandException {
    if (personSelected == null) {
        throw new CommandException("Please select a person");
    }
    setMapsChosenTrue();
    setLinkedinChosenFalse();
    loadPage(GOOGLE_MAPS_URL_PREFIX + person.getAddress().toString().replaceAll(" ", "+")
            + GOOGLE_SEARCH_URL_SUFFIX);
}
----

==== Design Considerations

**Aspect:** Passing URL directly +
**Alternative 1:** Use google maps API +
**Pros:** More powerful and secure search +
**Cons:** Unnecessary imports of dependencies, slows the program +

---

=== Profile Photo

A profile photo is displayed for each person in the addressbook.

==== Implementation

During startup, the application uses a person's email address to download his/her profile photo from link:https://en.gravatar.com/site/implement/[Gravatar] `cache/`. The photo will then be displayed on the person card.
When a new person is added or a person's email address is changed, the new profile photo will be downloaded. +
For contacts who have not set a Gravatar photo before, user also has the option to choose what type of default photo to
display.

==== Design Considerations

**Aspect:** source of the profile photos +
**Alternative 1 (current choice):** Gravatar +
**Pros:** easy to implement; does not require user to input extra information +
**Cons:** less customizable +
**Alternative 2:** from other social network websites (Instagram, Facebook, etc.) +
**Pros:** OurAb's target demographics usually update their profile photos on SNS more frequently +
**Cons:** authentication might be required; User need to input contacts' user id for different websites +
**Alternative 3:** user uploads profile photo for each person +
**Pros:** user has most freedom to customize their addressbook +
**Cons:** upload photo would be too complicated for a CLI application +

**Aspect:** download photos in foreground or background+
**Alternative 1 (current choice):** only download in background when the `DefaultProfilePhoto` preference is changed +
**Pros:** the solution is balanced between program response time and update time (see below for explanation on the trade-off) +
**Cons:** user might not see the change immediately after changing the preference +
**Alternative 2:** always download in foreground +
**Pros:** profile photos will be updated as soon as they are available +
**Cons:** the application will freeze during the download; if `DefaultProfilePhoto` preference is changed, the application will appear unresponsive +
**Alternative 3:** always download in background +
**Pros:** user will not notice any unresponsiveness when using the application +
**Cons:** it is technically challenging to update the photo in UI timely (concurrency is difficult)

---

=== Meeting Display

Displays the list of upcoming meetings to the user on the main display window. Accessible through the `choose` command to select the display type.

==== Implementation

When the user executes the `choose` command under the `meeting` keyword, an event is raised to hide the current display, which is a WebView.
Since the meeting display cannot be implemented using a WebView, the root view of the BrowserPanel.fxml is first removed from the placeholder, then the view of MeetingPanel.fxml is added into the placeholder instead.
The meeting information is retrieved from a ReadOnlyMeetingList converted into an ObservableList<Meeting>, and stored into a list view with list cells containing 5x1 GridPanes, each populated with information on the meeting.

==== Design Considerations

**Aspect:** Constructor of the MeetingPanel class +
**Alternative:** Instead of taking in logic, directly take in an ObservableList<Meeting> that is called from MainWindow.java. +
**Pros:** Less coupling since there is no logic component in the MeetingPanel class. +
**Cons:** Since the Meeting class does not have getter methods to obtain person strings and instead uses a mapped unique id system to obtain each person's name through the ReadOnlyAddressBook, a instance of the model object is required to obtain the strings of each person's name in the meeting object. +
**Alternative 2:** Implement a direct getter method for the person's string in the meeting object. +
**Pros:** Lesser code complexity; we no longer need a method in the LogicManager class to obtain person strings through the ReadOnlyAddressBook using the Meeting class' unique IDs. +
**Pros:** Less coupling since there is no logic component in the MeetingPanel class. +
**Cons:** Invalidates the unique id system currently in place for the meeting class.

---

== Documentation

We use asciidoc for writing documentation.

[NOTE]
We chose asciidoc over Markdown because asciidoc, although a bit more complex than Markdown, provides more flexibility in formatting.

=== Editing Documentation

See <<UsingGradle#rendering-asciidoc-files, UsingGradle.adoc>> to learn how to render `.adoc` files locally to preview the end result of your edits.
Alternatively, you can download the AsciiDoc plugin for IntelliJ, which allows you to preview the changes you have made to your `.adoc` files in real-time.

=== Publishing Documentation

See <<UsingTravis#deploying-github-pages, UsingTravis.adoc>> to learn how to deploy GitHub Pages using Travis.

=== Converting Documentation to PDF format

We use https://www.google.com/chrome/browser/desktop/[Google Chrome] for converting documentation to PDF format, as Chrome's PDF engine preserves hyperlinks used in webpages.

Here are the steps to convert the project documentation files to PDF format.

.  Follow the instructions in <<UsingGradle#rendering-asciidoc-files, UsingGradle.adoc>> to convert the AsciiDoc files in the `docs/` directory to HTML format.
.  Go to your generated HTML files in the `build/docs` folder, right click on them and select `Open with` -> `Google Chrome`.
.  Within Chrome, click on the `Print` option in Chrome's menu.
.  Set the destination to `Save as PDF`, then click `Save` to save a copy of the file in PDF format. For best results, use the settings indicated in the screenshot below.

image::chrome_save_as_pdf.png[width="300"]
_Figure 5.6.1 : Saving documentation as PDF files in Chrome_

== Testing

=== Running Tests

There are three ways to run tests.

[TIP]
The most reliable way to run tests is the 3rd one. The first two methods might fail some GUI tests due to platform/resolution-specific idiosyncrasies.

*Method 1: Using IntelliJ JUnit test runner*

* To run all tests, right-click on the `src/test/java` folder and choose `Run 'All Tests'`
* To run a subset of tests, you can right-click on a test package, test class, or a test and choose `Run 'ABC'`

*Method 2: Using Gradle*

* Open a console and run the command `gradlew clean allTests` (Mac/Linux: `./gradlew clean allTests`)

[NOTE]
See <<UsingGradle#, UsingGradle.adoc>> for more info on how to run tests using Gradle.

*Method 3: Using Gradle (headless)*

Thanks to the https://github.com/TestFX/TestFX[TestFX] library we use, our GUI tests can be run in the _headless_ mode. In the headless mode, GUI tests do not show up on the screen. That means the developer can do other things on the Computer while the tests are running.

To run tests in headless mode, open a console and run the command `gradlew clean headless allTests` (Mac/Linux: `./gradlew clean headless allTests`)

=== Types of tests

We have two types of tests:

.  *GUI Tests* - These are tests involving the GUI. They include,
.. _System Tests_ that test the entire App by simulating user actions on the GUI. These are in the `systemtests` package.
.. _Unit tests_ that test the individual components. These are in `seedu.address.ui` package.
.  *Non-GUI Tests* - These are tests not involving the GUI. They include,
..  _Unit tests_ targeting the lowest level methods/classes. +
e.g. `seedu.address.commons.StringUtilTest`
..  _Integration tests_ that are checking the integration of multiple code units (those code units are assumed to be working). +
e.g. `seedu.address.storage.StorageManagerTest`
..  Hybrids of unit and integration tests. These test are checking multiple code units as well as how the are connected together. +
e.g. `seedu.address.logic.LogicManagerTest`


=== Troubleshooting Testing
**Problem: `HelpWindowTest` fails with a `NullPointerException`.**

* Reason: One of its dependencies, `UserGuide.html` in `src/main/resources/docs` is missing.
* Solution: Execute Gradle task `processResources`.

== Dev Ops

=== Build Automation

See <<UsingGradle#, UsingGradle.adoc>> to learn how to use Gradle for build automation.

=== Continuous Integration

We use https://travis-ci.org/[Travis CI] and https://www.appveyor.com/[AppVeyor] to perform _Continuous Integration_ on our projects. See <<UsingTravis#, UsingTravis.adoc>> and <<UsingAppVeyor#, UsingAppVeyor.adoc>> for more details.

=== Making a Release

Here are the steps to create a new release.

.  Update the version number in link:{repoURL}/src/main/java/seedu/address/MainApp.java[`MainApp.java`].
.  Generate a JAR file <<UsingGradle#creating-the-jar-file, using Gradle>>.
.  Tag the repo with the version number. e.g. `v0.1`
.  https://help.github.com/articles/creating-releases/[Create a new release using GitHub] and upload the JAR file you created.

=== Managing Dependencies

A project often depends on third-party libraries. For example, Address Book depends on the http://wiki.fasterxml.com/JacksonHome[Jackson library] for XML parsing. Managing these _dependencies_ can be automated using Gradle. For example, Gradle can download the dependencies automatically, which is better than these alternatives. +
a. Include those libraries in the repo (this bloats the repo size) +
b. Require developers to download those libraries manually (this creates extra work for developers)

[appendix]
== User Stories

Priorities: High (must have) - `* * \*`, Medium (nice to have) - `* \*`, Low (unlikely to have) - `*`

[width="59%",cols="22%,<23%,<25%,<30%",options="header",]
|=======================================================================
|Priority |As a ... |I want to ... |So that I can...
|`* * *` |new user |see usage instructions |refer to instructions when I forget how to use the App

|`* * *` |user |add a new person |

|`* * *` |user |delete a person |remove entries that I no longer need

|`* * *` |user |find a person by name |locate details of persons without having to go through the entire list

|`* * *` |user |filter contacts by name, number, address, email or tag |find specific contacts easily

|`* * *` |basic user |add display pictures to my contacts |easily identify people with the same name

|`* * *` |basic user |call/email my contacts by clicking on them |save time in opening my email or phoning app

|`* * *` |basic user |be able to change the theme of the app from dark to light |reduce the stress on my eyes

|`* * *` |basic user |customise the background picture of the app |enhance my user experience since it looks nicer

|`* *` |user |edit my tags more conveniently |not need to delete all the tags when editing somebody's tags

|`* *` |user |hide link:#private-contact-detail[private contact details] by default |minimize chance of someone else seeing them by accident

|`* *` |basic user |be able to put tags of different colours on my contacts |identify them more easily

|`* *` |new user |add more icons to the app |make it look prettier

|`* *` |new user |see several interactive text fields like a template when I use the add command |not need to memorise the command for adding people

|`* *` |user who uses other address book apps |import/export my address book to other format |transfer address book data between applications easily

|`* *` |user who often contacts people |add Speed dial or a favourites list |easily contact those that I am in frequent touch with

|`* *` |user with bad vision |adjust the font size of the address book |see the contents easily

|`* *` |user who has contacts with many tags |have each tag with their own associated colour |customise my contacts better for my own visibility

|`*` |user |look at a prettier address book |enhance my user experience

|`*` |user |find people near me using their addresses |contact them more conveniently

|`*` |user |record the birthdays of my contacts |know when to celebrate their birthdays

|`*` |user |receive a notification on my contacts birthdays |know when they are and celebrate them

|`*` |user |add chinese names |record my chinese friends with no english names

|`*` |basic user |open the address book maximised |focus on the address book itself

|`*` |advanced user |use shorter versions of a command |speed up finding contacts

|`*` |new user |enter a confirmation before executing any delete command |make sure I do not delete the wrong person

|`*` |user who likes nice fonts |change the address book font to something like quicksand |make it look prettier

|`*` |user who likes variety |change the font colour based on my mood |feel better while using the address book

|`*` |user who is concerned about security |use a login system |secure my contacts information

|`*` |user with bad memory |receive a hint for correct commands when I type something similar that is incorrect |remove the hassle of memorising commands

|`*` |user who frequently needs to send mail |create a mailing list |send mail more conveniently

|`*` |user who loves convenience |access edit and delete functions quickly |use the address book more efficiently and save time

|`*` |user who is also a programmer |search using regular expression |search for contacts more precisely

|`*` |ultra-book user |adjust the application to my viewport |scale it down to the size of my laptop screen

|`*` |user with many friends |see their birthdays collated and displayed in a calendar |know when to prepare for their birthdays

|`*` |user with many persons in the address book |sort persons by name |locate a person easily
|=======================================================================

{More to be added}

[appendix]
== Use Cases

(For all use cases below, the *System* is the `AddressBook` and the *Actor* is the `user`, unless specified otherwise)

[discrete]
=== Use case: Add person

*MSS*

1.  User requests to add a new person
2.  AddressBook adds the person
+
Use case ends.

*Extensions*

[none]
* 2a. The person is already in the address book
+
[none]
** 2a1. AddressBook shows an error message.
+
Use case resumes at step 1.

* 2b. The command format is invalid
+
[none]
** 2b1. AddressBook shows an error message.
+
Use case resumes at step 1.

[discrete]
=== Use case: Delete person

*MSS*

1.  User requests to list persons
2.  AddressBook shows a list of persons
3.  User requests to delete a specific person in the list
4.  AddressBook deletes the person
+
Use case ends.

*Extensions*

[none]
* 2a. The list is empty.
+
Use case ends.

* 3a. The given index is invalid.
+
[none]
** 3a1. AddressBook shows an error message.
+
Use case resumes at step 2.

[discrete]
=== Use case: Edit person

*MSS*

1.  User requests to list persons
2.  AddressBook shows a list of persons
3.  User requests to edit a specific person in the list
4.  AddressBook edits the person's contact details given by user
+
Use case ends.

*Extensions*

[none]
* 2a. The list is empty.
+
Use case ends.

* 3a. No one has been searched before
+
[none]
** 3a1. AddressBook shows an error message.
+
Use case resumes at step 2.

* 3b. The command format is invalid
+
[none]
** 3b1. AddressBook shows an error message.
+
Use case resumes at step 2.

[discrete]
=== Use case: List by most searched

*MSS*

1.  User requests to list persons by search frequency
2.  AddressBook sorts persons by number of times each person is searched
3.  Addressbook lists persons in descending order, with the person most searched
being at the top of the list.

+
Use case ends.

*Extensions*

[none]
* 1a. The list is empty.
+
Use case ends.

* 2a. No one has been searched before
+
** AddressBook continues to step 3
+
Use case ends.


[appendix]
== Non Functional Requirements

.  Should work on any link:#mainstream-os[mainstream OS] as long as it has Java `1.8.0_60` or higher installed
.  Should be able to hold up to 1000 persons without a noticeable sluggishness in performance for typical usage
.  A user with above average typing speed for regular English text (i.e. not code, not system admin commands) should be able to accomplish most of the tasks faster using commands than using the mouse
.  Should have support for UTF-8 chracters
.  Should have an intuitive UI such that a new user can become familiarized with the application easily
.  Should have an attractive UI so that potential users will be more inclined to try out this application
.  Should be responsive to viewports of different sizes
.  Users should be able to use the application within 5 seconds of starting the application
.  Users should be familiar with using all functions of the application within a day
.  Should at most take 10 seconds for any method invoked by users to return results
.  Should have similar performance for all UI themes and fonts picked


[appendix]
== Glossary

[[mainstream-os]]
Mainstream OS

....
Windows, Linux, Unix, OS-X
....

[[private-contact-detail]]
Private contact detail

....
A contact detail that is not meant to be shared with others
....


//[appendix]
//== Product Survey
//
//*Product Name*
//
//Author: ...
//
//Pros:
//
//* ...
//* ...
//
//Cons:
//
//* ...
//* ...
